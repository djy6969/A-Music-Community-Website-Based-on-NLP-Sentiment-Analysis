(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3c831644"],{"05c1":function(t,e,s){"use strict";s("7694")},2019:function(t,e,s){"use strict";s("44e5")},"44e5":function(t,e,s){},7694:function(t,e,s){},eb0e:function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"leftSide"},[e("div",{staticClass:"search_chat"},[e("div",{staticStyle:{display:"flex"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.friendId,expression:"friendId"}],attrs:{placeholder:"Add New Friend",type:"text"},domProps:{value:t.friendId},on:{input:function(e){e.target.composing||(t.friendId=e.target.value)}}}),e("el-button",{on:{click:t.addFriend}},[t._v("Add")])],1)]),t._l(this.friendList,(function(s,i){return e("chat-list",{key:i,attrs:{id:s},nativeOn:{click:function(e){return t.startChatroom(s)}}})}))],2),e("div",{staticClass:"rightSide",staticStyle:{width:"80%"}},[e("div",{staticClass:"header"},[e("div",{staticClass:"imgText"},[e("div",{staticClass:"userimg"},[e("el-avatar",{attrs:{src:t.friendData.avatarUrl}})],1),e("h4",[t._v(t._s(this.friendData.friendName))])]),t._m(0)]),e("div",{staticClass:"chatBox"},t._l(t.chatData,(function(s,i){return e("div",{key:i},["user"===s.actor?e("div",{staticClass:"message my_message"},[e("p",[t._v(t._s(s.content)),e("br"),e("span",[t._v(t._s(s.time))])])]):t._e(),"friend"===s.actor?e("div",{staticClass:"message frnd_message"},[e("p",[t._v(t._s(s.content)),e("br"),e("span",[t._v(t._s(s.time))])])]):t._e()])})),0),e("div",{staticClass:"chatbox_input"},[e("div",{staticClass:"instrument"},[e("el-button",{on:{click:t.leaveChatroom}},[t._v("Leave")]),e("img",{attrs:{src:"表情.png"}}),e("img",{attrs:{src:"语音.png"}})],1),e("div",[e("input",{directives:[{name:"model",rawName:"v-model",value:t.sendData,expression:"sendData"}],attrs:{type:"text"},domProps:{value:t.sendData},on:{input:function(e){e.target.composing||(t.sendData=e.target.value)}}}),e("el-button",{on:{click:t.sendMessage}},[t._v("Send")])],1)])])])},n=[function(){var t=this,e=t._self._c;return e("ul",{staticClass:"nav_icons"},[e("li",[e("img",{attrs:{src:"消息.png"}})]),e("li",[e("img",{attrs:{src:"更多.png"}})])])}],a=s("ed08"),o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chatlist"},[e("div",{staticClass:"block active"},[e("div",{staticClass:"imgbx"},[e("el-avatar",{attrs:{src:t.friendInfo.avatar}})],1),e("div",{staticClass:"details"},[e("div",{staticClass:"listHead"},[e("h4",[t._v(t._s(t.friendInfo.nickname))])])])])])},c=[],r={name:"chatList",props:["id"],data:function(){return{friendInfo:{nickname:"",avatar:""}}},methods:{loadFriendInfo:function(){var t=this;a["newRequest"].post("/account/get_user_info",{user_id:this.id}).then((function(e){200===e.code&&(t.friendInfo.nickname=e.data.nickname,t.friendInfo.avatar=e.data.head_protrait)}))},chatWithFriend:function(){var t=this;a["newRequest"].post("/chat/add_chatroom",{user_id:this.$cookies.get("auth").userid,friend_id:this.id}).then((function(e){console.log(e),200===e.code?(t.$message.success(e.msg),t.$cookies.set("chatRoom",{room:e.data.chatroom_id,id:e.data.id}),t.$socket.emit("join",{username:t.$cookies.get("auth").username,room:t.$cookies.get("chatRoom").room}),console.log("socket join"),t.$emit("transfer",t.friendInfo.nickname)):t.$message.error("Something Wrong! Try Again!")}))}},mounted:function(){this.loadFriendInfo()}},d=r,u=(s("2019"),s("0c7c")),l=Object(u["a"])(d,o,c,!1,null,"bb3041de",null),h=l.exports,m={name:"index",components:{ChatList:h},data:function(){return{friendId:0,friendList:[],friendData:{friendName:"None",id:"",avatarUrl:""},chatData:[],sendData:""}},sockets:{connect:function(){console.log("链接成功")},disconnect:function(){console.log("断开链接")},reconnect:function(){console.log("重新链接")},kline:function(t){console.log(t)},data:function(t){console.log(t,"5555555555")},send_msg:function(t){console.log(this.chatData),t.username!==this.$cookies.get("auth").username&&this.chatData.push({actor:"friend",content:t.message,time:this.getNowTime()})}},methods:{getNowTime:function(){var t=new Date(Date.now()),e=t.getFullYear(),s=t.getMonth()+1,i=t.getDate();return e+"-"+(s<10?"0"+s:s)+"-"+(i<10?"0"+i:i)+" "+t.toTimeString().substr(0,8)},startChatroom:function(t){var e=this;a["newRequest"].post("/account/get_user_info",{user_id:t}).then((function(s){e.friendData.id=t,e.friendData.friendName=s.data.nickname,e.friendData.avatarUrl=s.data.head_protrait,a["newRequest"].post("/chat/add_chatroom",{user_id:e.$cookies.get("auth").userid,friend_id:e.friendData.id}).then((function(t){console.log(t),200===t.code?(e.$message.success(t.msg),e.$cookies.set("chatRoom",{room:t.data.chatroom_id,id:t.data.id}),e.$socket.emit("join",{username:e.$cookies.get("auth").username,room:e.$cookies.get("chatRoom").room}),console.log("socket join")):e.$message.error("Something Wrong! Try Again!")}))}))},addFriend:function(){var t=this;a["newRequest"].post("/friend/addFriend",{user_id:this.$cookies.get("auth").userid,friend_id:this.friendId}).then((function(e){200===e.code&&(t.$message({message:"Add new Friend Success!",type:"success"}),t.friendId=0)}))},getFriends:function(){var t=this;a["newRequest"].post("/friend/getFriends",{user_id:this.$cookies.get("auth").userid}).then((function(e){200===e.code&&(t.friendList=e.data,console.log(t.friendList))}))},checkAllChatroom:function(){a["newRequest"].post("/chat/check_all_chatroom",{user_id:this.$cookies.get("auth").userid}).then((function(t){console.log(t)}))},sendMessage:function(){this.$socket.emit("send msg",{username:this.$cookies.get("auth").username,room:this.$cookies.get("chatRoom").room,message:this.sendData},(function(t){console.log(t)})),this.chatData.push({actor:"user",content:this.sendData,time:this.getNowTime()}),this.sendData=""},leaveChatroom:function(){this.$socket.emit("leave",{username:this.$cookies.get("auth").username,room:this.$cookies.get("chatRoom").room})}},mounted:function(){this.getFriends(),this.checkAllChatroom()}},f=m,g=(s("05c1"),Object(u["a"])(f,i,n,!1,null,"bc909548",null));e["default"]=g.exports}}]);